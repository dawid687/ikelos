<!doctype html>
<html lang="pl">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ikelos - Narmeria</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    :root {
      --sidebar-w: 340px;
      --bg: #0f1115;
      --panel: #151922;
      --border: #232838;
      --text: #e7e9ee;
      --muted: #9aa3b2;
      --accent: #e11919;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    body {
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    .app {
      display: flex;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
    }

    aside#legend {
      width: var(--sidebar-w);
      background: var(--panel);
      border-right: 1px solid var(--border);
      padding: 14px;
      overflow: auto;
    }

    .legend-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .legend-title {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: .2px;
    }

    .legend-search {
      width: 100%;
      margin-bottom: 10px;
      background: #0c0f16;
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
    }

    .legend-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .legend-item {
      width: 100%;
      display: flex;
      gap: 10px;
      align-items: flex-start;
      background: #0e121a;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      text-align: left;
      cursor: pointer;
      color: inherit;
    }

    .legend-item:hover {
      border-color: #2b3550;
      background: #101622;
    }

    .legend-item.active {
      outline: 2px solid var(--accent);
      outline-offset: 0;
    }

    .badge {
      display: inline-grid;
      place-items: center;
      min-width: 28px;
      height: 28px;
      padding: 0 6px;
      border-radius: 999px;
      background: var(--accent);
      color: white;
      font-weight: 800;
      font-size: 14px;
      line-height: 1;
      box-shadow: 0 0 0 2px rgba(0, 0, 0, .25);
      transform: translateY(2px);
    }

    .legend-item .info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .legend-item .name {
      font-weight: 700;
      font-size: 14px;
    }

    .legend-item .desc {
      color: var(--muted);
      font-size: 13px;
    }

    #map {
      flex: 1 1 auto;
      height: 100%;
      width: 100%;
    }

    .marker-num {
      display: grid;
      place-items: center;
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: var(--accent);
      color: #fff;
      font-weight: 800;
      font-size: 14px;
      box-shadow: 0 0 0 2px rgba(0, 0, 0, .35);
    }

    .marker-num span {
      transform: translateY(-1px);
    }

    .marker-num.active {
      box-shadow: 0 0 0 3px rgba(225, 25, 25, .45);
    }

    .popup-big .leaflet-popup-content {
      font-size: 16px;
      line-height: 1.5;
      color: #0b1220;
    }

    .popup-big .leaflet-popup-content-wrapper {
      padding: 14px 18px;
      border-radius: 12px;
    }

    .popup-big .leaflet-popup-tip {
      width: 12px;
      height: 12px;
    }

    .leaflet-tooltip.tooltip-big {
      font-size: 14px;
      padding: 6px 10px;
      border-radius: 8px;
    }

    .toggle {
      position: absolute;
      z-index: 1000;
      top: 12px;
      left: 12px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
      cursor: pointer;
    }

    @media (max-width: 900px) {
      aside#legend {
        position: absolute;
        z-index: 1000;
        left: 0;
        top: 0;
        bottom: 0;
        transform: translateX(-102%);
        transition: transform .25s ease;
      }

      aside#legend.open {
        transform: translateX(0);
      }

      #map {
        position: relative;
      }

      .toggle {
        display: block;
      }
    }

    @media (min-width: 901px) {
      .toggle {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <aside id="legend" aria-label="Legenda miejsc">
      <div class="legend-header">
        <div class="legend-title">Legenda miejsc</div>
      </div>
      <input id="legendSearch" class="legend-search" type="search" placeholder="Szukaj po nazwie lub opisie…" />
      <ul id="legendList" class="legend-list"></ul>
    </aside>
    <button id="toggleBtn" class="toggle" aria-controls="legend" aria-expanded="false">Legenda</button>
    <div id="map" role="region" aria-label="Mapa"></div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const w = 3152, h = 3312;
    const bounds = [[0, 0], [h, w]];

    const map = L.map('map', {
      crs: L.CRS.Simple,
      zoomControl: true,
      dragging: true,
      scrollWheelZoom: true,
      doubleClickZoom: true,
      touchZoom: true,
      minZoom: -4,
      maxZoom: 4
    });

    L.imageOverlay('ikelos.png', bounds).addTo(map);
    map.fitBounds(bounds);
    map.setMaxBounds(bounds);
    map.options.maxBoundsViscosity = 0.8;

    const places = [
      { id: 1, name: 'Najwyższa Świątynia Trastigosa', pos: [1519, 1488], district: "Trastigion", tags: ["Religia", "Trastigos"] },
      { id: 2, name: 'Zgromadzenie Rady Kolegialnej Kościoła Trastigosa', pos: [1544, 1572], district: "Trastigion", tags: ["Władza", "Rada"] },
      { id: 3, name: 'Kancelaria zgromadzenia i archiwum państwowe', pos: [1510, 1575], district: "Trastigion", tags: ["Władza", "Rada", "Księgi"] },
      { id: 4, name: 'Skarbiec stolicy i dom Kapłanów Złotników', pos: [1507, 1382], district: "Trastigion", tags: ["Władza", "Złotnicy"] },
      { id: 5, name: 'Brama Północna', pos: [2898, 1468], district: "Keramejka", tags: ["Obrona", "Straż"] },
      { id: 6, name: 'Brama Garncarzy', pos: [2784, 1171], district: "Keramejka", tags: ["Obrona", "Straż"] },
      { id: 7, name: 'Nowa Brama', pos: [2477, 710], district: "Keramejka", tags: ["Obrona", "Straż"] },
      { id: 8, name: 'Brama Snycerzy', pos: [2067, 411], district: "Noxya", tags: ["Obrona", "Straż"] },
      { id: 9, name: 'Brama Południowego Brzegu', pos: [1784, 253], district: "Livia", tags: ["Obrona", "Straż"] },
      { id: 10, name: 'Brama Kupiecka', pos: [1250, 221], district: "Wzgórza Berit", tags: ["Obrona", "Straż"] },
      { id: 11, name: 'Biała Brama', pos: [963, 395], district: "Wzgórza Berit", tags: ["Obrona", "Straż"] },
      { id: 12, name: 'Brama Złotników', pos: [325, 1040], district: "Ścieżki Feanora i Myrry", tags: ["Obrona", "Straż"] },
      { id: 13, name: 'Stalowa Brama', pos: [263, 1437], district: "Ścieżki Feanora i Myrry", tags: ["Obrona", "Straż"] },
      { id: 14, name: 'Brama Kamieniarzy', pos: [311, 1906], district: "Ogrody Junn", tags: ["Obrona", "Straż"] },
      { id: 15, name: 'Wielka Brama', pos: [494, 2124], district: "Ogrody Junn", tags: ["Obrona", "Straż"] },
      { id: 16, name: 'Brama Piekarzy', pos: [686, 2360], district: "Ogrody Junn", tags: ["Obrona", "Straż"] },
      { id: 17, name: 'Wschodnia Brama', pos: [1169, 2742], district: "Ogrody Junn", tags: ["Obrona", "Straż"] },
      { id: 18, name: 'Młyńska Brama', pos: [1682, 2834], district: "Gaj Aquilli", tags: ["Obrona", "Straż"] },
      { id: 19, name: 'Wysoka Brama', pos: [2253, 2664], district: "Gaj Aquilli", tags: ["Obrona", "Straż"] },
      { id: 20, name: 'Brama Mieczników', pos: [2575, 2182], district: "Gaj Aquilli", tags: ["Obrona", "Straż"] },
      { id: 21, name: 'Północny oddział straż miejskiej', pos: [2484, 1353], district: "Keramejka", tags: ["Obrona", "Straż"] },
      { id: 22, name: 'Rzeczny oddział straż miejskiej', pos: [2284, 1692], district: "Gaj Aquilli", tags: ["Obrona", "Straż", "Rzeka"] },
      { id: 23, name: 'Konny oddział straż miejskiej', pos: [1291, 712], district: "Livia", tags: ["Obrona", "Straż"] },
      { id: 24, name: 'Środkowy oddział straż miejskiej', pos: [1020, 1838], district: "Ogrody Junn", tags: ["Obrona", "Straż"] },
      { id: 25, name: 'Anaktoron', pos: [1592, 1492], district: "Archontia", tags: ["Obrona", "Twierdza", "Armia"] },
      { id: 26, name: 'Koszary Aquilli', pos: [2175, 2188], district: "Gaj Aquilli", tags: ["Armia", "Aquilla"] },
      { id: 27, name: 'Koszary Południowe', pos: [478, 1364], district: "Ścieżki Feanora i Myrry", tags: ["Armia"] },
      { id: 28, name: 'Areszt miejski', pos: [1050, 1777], district: "Ścieżki Feanora i Myrry", tags: ["Straż"] },
      { id: 29, name: 'Świątynia Horkosa', pos: [1989, 1896], district: "Horkopleia", tags: ["Religia", "Horkos"] },
      { id: 30, name: 'Kaplica Nox', pos: [2052, 1469], district: "Noxya", tags: ["Religia", "Nox"] },
      { id: 31, name: 'Świątynia Aquilli', pos: [2340, 2262], district: "Gaj Aquilli", tags: ["Religia", "Aquilla"] },
      { id: 32, name: 'Świątynia Junn', pos: [1331, 2205], district: "Ogrody Junn", tags: ["Religia", "Junn"] },
      { id: 33, name: 'Świątynia Livo', pos: [1644, 897], district: "Livia", tags: ["Religia", "Livo"] },
      { id: 34, name: 'Kaplica Berit', pos: [1094, 755], district: "Wzgórza Berit", tags: ["Religia", "Berit"] },
      { id: 35, name: 'Kaplica Feanora i Myrry', pos: [790, 1251], district: "Ścieżki Feanora i Myrry", tags: ["Religia", "Feanor"] },
      { id: 36, name: 'Miejska Nekropolia', pos: [956, 968], district: "Ścieżki Feanora i Myrry", tags: ["Cmentarz"] },
      { id: 37, name: 'Nowa Nekropolia', pos: [2098, 178], district: "Szare Wody", tags: ["Cmentarz"] },
      { id: 38, name: 'Most Kupiecki', pos: [2484, 1816], district: "Gaj Aquilli", tags: ["Rzeka", "Sklep", "Gildia"] },
      { id: 39, name: 'Most Złotników', pos: [1882, 1563], district: "Horkopleia", tags: ["Rzeka", "Sklep", "Gildia"] },
      { id: 40, name: 'Most Jubilerów', pos: [1804, 1539], district: "Horkopleia", tags: ["Rzeka", "Sklep", "Gildia"] },
      { id: 41, name: 'Most Kamieniarzy', pos: [1757, 1507], district: "Archontia", tags: ["Rzeka", "Gildia"] },
      { id: 42, name: 'Most Piekarzy', pos: [1692, 1209], district: "Livia", tags: ["Rzeka", "Sklep", "Gildia"] },
      { id: 43, name: 'Most Snycerzy', pos: [1660, 1261], district: "Trastigion", tags: ["Rzeka", "Sklep", "Gildia"] },
      { id: 44, name: 'Most Mieczników', pos: [1667, 1416], district: "Archontia", tags: ["Rzeka", "Gildia"] },
      { id: 45, name: 'Nabrzeże Złotników', pos: [2133, 1679], district: "Horkopleia", tags: ["Rzeka", "Gildia"] },
      { id: 46, name: 'Termy Korydona', pos: [1742, 1775], district: "Horkopleia", tags: ["Łaźnia"] },
      { id: 47, name: 'Termy Proxenosa', pos: [1515, 1062], district: "Livia", tags: ["Łaźnia"] },
      { id: 48, name: 'Emporium', pos: [1028, 630], district: "Wzgórza Berit", tags: ["Sklep"] },
      { id: 49, name: 'Filia Banku Kekropyjskiego', pos: [1244, 1615], district: "Trastigion", tags: ["Bank"] },
      { id: 50, name: 'Biblioteka Miejska', pos: [824, 2106], district: "Ogrody Junn", tags: ["Nauka", "Księgi"] },
      { id: 51, name: 'Skryptorium', pos: [977, 2239], district: "Ogrody Junn", tags: ["Nauka", "Księgi"] },
      { id: 52, name: 'Akademia Retoryki i Prawa', pos: [1833, 2045], district: "Horkopleia", tags: ["Nauka", "Horkos"] },
      { id: 53, name: 'Szkoła Inżynierska', pos: [1424, 1224], district: "Livia", tags: ["Nauka"] },
      { id: 54, name: 'Kolegium Arkanistów', pos: [2095, 1349], district: "Noxya", tags: ["Nauka", "Magia"] },
      { id: 55, name: 'Amfiteatr', pos: [1564, 1304], district: "Trastigion", tags: ["Rozrywka"] },
      { id: 56, name: 'Cyrk Uliczny', pos: [1517, 2351], district: "Ogrody Junn/Gaj Aquilli", tags: ["Rozrywka"] },
      { id: 57, name: 'Teatr Lalkowy', pos: [641, 964], district: "Ścieżki Feanora i Myrry", tags: ["Rozrywka"] },
      { id: 58, name: 'Beleuterion', pos: [1472, 1683], district: "Horkopleia", tags: ["Władza"] },
      { id: 59, name: 'Dikasterion', pos: [1644, 1758], district: "Horkopleia", tags: ["Władza"] },
      { id: 60, name: 'Trastigonejon miejski', pos: [1248, 1224], district: "Livia", tags: ["Nauka", "Trastigos", "Leczenie"] },
      { id: 61, name: 'Trastigonejon świątynny', pos: [1401, 1517], district: "Trastigion", tags: ["Nauka", "Trastigos", "Leczenie", "Religia"] },
      { id: 62, name: 'Trastigonejon wojskowy', pos: [2093, 2148], district: "Gaj Aquilli", tags: ["Nauka", "Trastigos", "Leczenie", "Armia"] },
      { id: 63, name: 'Willa rodziny Mirias', pos: [1830, 1244], district: "Noxya", tags: ["Szlachta"] },
      { id: 64, name: 'Willa rodziny Desmis', pos: [1646, 444], district: "Livia", tags: ["Szlachta"] },
      { id: 65, name: 'Willa rodziny Aethre', pos: [1889, 2472], district: "Gaj Aquilli", tags: ["Szlachta"] },
      { id: 66, name: 'Willa rodziny Arkhippe', pos: [2197, 890], district: "Noxya", tags: ["Szlachta"] },
      { id: 67, name: 'Handlarz Wierzchowców', pos: [607, 1950], district: "Ogrody Junn", tags: ["Sklep"] },
      { id: 68, name: 'Złoty Athanor', pos: [1378, 916], district: "Livia", tags: ["Rzemiosło", "Alchemik"] },
      { id: 69, name: 'Laboratorium Pod Obeliskiem', pos: [1390, 449], district: "Livia", tags: ["Rzemiosło", "Alchemik"] },
      { id: 70, name: 'Stalowe Korzenie', pos: [2446, 1614], district: "Keramejka", tags: ["Rzemiosło", "Kowal"] },
      { id: 71, name: 'Kuźnia Kolosów', pos: [2400, 960], district: "Keramejka", tags: ["Rzemiosło", "Kowal"] },
      { id: 72, name: 'Runa i Żelazo', pos: [1282, 1990], district: "Ogrody Junn", tags: ["Rzemiosło", "Kowal"] },
      { id: 73, name: 'Krasnoludzkie Miechy', pos: [936, 1386], district: "Ścieżki Feanora i Myrry", tags: ["Rzemiosło", "Kowal"] },
      { id: 74, name: 'Pod Skrzydłem Pegaza', pos: [1136, 2392], district: "Ogrody Junn", tags: ["Rozrywka", "Karczma"] },
      { id: 75, name: 'U Krągłego Stołu', pos: [872, 1808], district: "Ogrody Junn", tags: ["Rozrywka", "Gospoda"] },
      { id: 76, name: 'Młot i Kufel', pos: [2142, 2428], district: "Gaj Aquilli", tags: ["Rozrywka", "Karczma"] },
      { id: 77, name: 'U Trzech Ław', pos: [1942, 2242], district: "Gaj Aquilli", tags: ["Rozrywka", "Gospoda"] },
      { id: 78, name: 'Złota Waga', pos: [2618, 1290], district: "Keramejka", tags: ["Rozrywka", "Karczma"] },
      { id: 79, name: 'Pod Znakiem Cechu', pos: [2660, 1738], district: "Keramejka", tags: ["Rozrywka", "Gospoda"] },
      { id: 80, name: 'Ciemny Nurt', pos: [1952, 948], district: "Noxya", tags: ["Rozrywka", "Karczma"] },
      { id: 81, name: 'Pod Skrytką', pos: [1126, 510], district: "Wzgórza Berit", tags: ["Rozrywka", "Gospoda"] },
      { id: 82, name: 'Przystmań Pod Kotwicą', pos: [1822, 962], district: "Livia", tags: ["Rozrywka", "Karczma"] },
      { id: 83, name: 'Jak U Mamy', pos: [1444, 590], district: "Livia", tags: ["Rozrywka", "Gospoda"] },
      { id: 84, name: 'Węgiel i Wędka', pos: [1880, 1638], district: "Horkopleia", tags: ["Rozrywka", "Karczma"] },
      { id: 85, name: 'Nurt i Nocleg', pos: [2025, 1643], district: "Horkopleia", tags: ["Rozrywka", "Gospoda"] },
      { id: 86, name: 'Worek Bez Dna', pos: [576, 1170], district: "Ścieżki Feanora i Myrry", tags: ["Rozrywka", "Karczma"] },
      { id: 87, name: 'Stary Kocioł', pos: [2258, 1278], district: "Noxya", tags: ["Rozrywka", "Gospoda"] },
      { id: 88, name: 'Pawi Dziedziniec', pos: [1986, 1118], district: "Noxya", tags: ["Rozrywka", "Lupanar"] },
      { id: 89, name: 'Ciche Poddasze', pos: [1466, 802], district: "Livia", tags: ["Rozrywka", "Lupanar"] },
      { id: 90, name: 'Aksamitna Izba', pos: [1632, 1982], district: "Horkopleia", tags: ["Rozrywka", "Lupanar"] },
      { id: 91, name: 'Krótkie Stopnie', pos: [618, 1524], district: "Ścieżki Feanora i Myrry", tags: ["Rozrywka", "Lupanar"] },
      { id: 92, name: 'Spiżowa Płyta', pos: [2528, 1212], district: "Keramejka", tags: ["Rzemiosło", "Płatnerz"] },
      { id: 93, name: 'Płaszcz ze skały', pos: [2690, 1496], district: "Keramejka", tags: ["Rzemiosło", "Płatnerz"] },
      { id: 94, name: 'Egida', pos: [2288, 2008], district: "Gaj Aquilli", tags: ["Rzemiosło", "Płatnerz"] },
      { id: 95, name: 'Sześć Piór', pos: [1059, 1181], district: "Ścieżki Feanora i Myrry", tags: ["Rzemiosło", "Łuczarz"] },
      { id: 96, name: 'Grot Vanrila', pos: [1434, 1881], district: "Horkopleia", tags: ["Rzemiosło", "Łuczarz"] },
      { id: 97, name: 'Pergaminy Junn', pos: [1113, 2102], district: "Ogrody Junn", tags: ["Sklep", "Magia"] },
      { id: 98, name: 'Koci Szept', pos: [2042, 786], district: "Noxya", tags: ["Sklep", "Magia"] },
      { id: 99, name: 'Tkacze Eteru', pos: [2234, 658], district: "Noxya", tags: ["Sklep", "Magia"] },
      { id: 100, name: 'Przystań Główna', pos: [2044, 1525], district: "Noxya", tags: ["Rzeka"] },
      { id: 101, name: 'Arsenał', pos: [2150, 2213], district: "Gaj Aquilli", tags: ["Armia"] },

    ];

    const makeNumberIcon = (n) => L.divIcon({
      className: '',
      html: `<div class="marker-num"><span>${n}</span></div>`,
      iconSize: [28, 28],
      iconAnchor: [14, 14],
      tooltipAnchor: [0, -18],
      popupAnchor: [0, -10],
    });

    const tooltipDefaults = {
      permanent: true,
      direction: 'top',
      offset: [0, -6],
      className: 'tooltip-big',
      opacity: 0.95,
    };

    const markers = new Map();
    const legendItems = new Map();

    function setActive(id) {
      legendItems.forEach((el, key) => {
        if (key === id) el.classList.add('active');
        else el.classList.remove('active');
      });
      markers.forEach((m, key) => {
        const icon = m.getElement();
        if (!icon) return;
        if (key === id) icon.classList.add('active');
        else icon.classList.remove('active');
      });
    }

    function focusPlace(p, openPopup = true) {
      map.flyTo(p.pos, Math.max(map.getZoom(), -1), { duration: 0.35 });
      const m = markers.get(p.id);
      if (m && openPopup) m.openPopup();
      setActive(p.id);
    }

    places.forEach(p => {
      const m = L.marker(p.pos, { icon: makeNumberIcon(p.id) })
        .addTo(map)
        .bindPopup(
          `<div><strong>${p.name}</strong></div>`,
          { className: 'popup-big' }
        )
        .on('click', () => setActive(p.id))
        .on('mouseover', () => setActive(p.id));

      markers.set(p.id, m);
    });

    const list = document.getElementById('legendList');
    const search = document.getElementById('legendSearch');

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, "&amp;").replace(/</g, "&lt;")
        .replace(/>/g, "&gt;").replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function renderTags(tags) {
      const arr = Array.isArray(tags)
        ? tags
        : (typeof tags === 'string'
          ? tags.split(/[;,|]\s*|\s+/).filter(Boolean)
          : []);

      return arr.map(t => `<span class="tag">#${escapeHtml(t.trim())}</span>`).join(' ');
    }

    function renderLegend(items) {
      list.innerHTML = '';
      items.forEach(p => {
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.className = 'legend-item';
        btn.type = 'button';
        btn.setAttribute('data-id', String(p.id));
        btn.innerHTML = `
          <span class="badge">${p.id}</span>
          <div class="info">
            <div class="name">${p.name}</div>
            ${p.district ? `<div class="district">${p.district}</div>` : ''}
           ${p.tags ? `<div class="tags">${renderTags(p.tags)}</div>` : ''}
          </div>
        `;
        btn.addEventListener('click', () => focusPlace(p, true));
        btn.addEventListener('mouseenter', () => setActive(p.id));
        li.appendChild(btn);
        list.appendChild(li);
        legendItems.set(p.id, btn);
      });
    }

    renderLegend(places);

    search.addEventListener('input', (e) => {
      const q = (e.target?.value ?? '').toString();
      const ql = q.trim().toLowerCase();

      const filtered = !ql ? places : places.filter(p => {
        const idMatch = String(p.id ?? '').toLowerCase().includes(ql);
        const nameMatch = (p.name ?? '').toLowerCase().includes(ql);
        const districtMatch = (p.district ?? '').toLowerCase().includes(ql);

        const rawTags = Array.isArray(p.tags)
          ? p.tags
          : (p.tags ? String(p.tags).split(/[;,]\s*/g) : []);
        const tagsMatch = rawTags.some(t => String(t ?? '').toLowerCase().includes(ql));

        return idMatch || nameMatch || districtMatch || tagsMatch;
      });

      renderLegend(filtered);
    });


    const toggleBtn = document.getElementById('toggleBtn');
    const legend = document.getElementById('legend');
    const setOpen = (open) => {
      if (open) { legend.classList.add('open'); toggleBtn.setAttribute('aria-expanded', 'true'); }
      else { legend.classList.remove('open'); toggleBtn.setAttribute('aria-expanded', 'false'); }
    };
    toggleBtn.addEventListener('click', () => {
      const isOpen = legend.classList.contains('open');
      setOpen(!isOpen);
    });

    const isMobile = window.matchMedia('(max-width: 900px)').matches;
    setOpen(!isMobile);

  </script>
</body>

</html>